gitcreds::gitcreds_set()
library(tidyverse)
library(tidygeocoder)
library(sf)
bbox1 <- "Berga"
bbox2 <- "el BerguedÃ "
library(httr)
library(jsonlite)
library(osmdata)
o <- opq("Berga")
get_bbox <- function(opq){
bbox <- opq$bbox
bbox <- as.vector(sapply(str_split(bbox,","), as.numeric))
return(bbox)
}
bbox <- get_bbox(o)
o$bbox
o$features
o$bbox
st_as_sf(o$bbox)
o$bbox |> as.vector(sapply(str_split(bbox,","), as.numeric))
o$bbox |> as.vector(sapply(str_split(_,","), as.numeric))
o$bbox |> as.vector(sapply(str_split(","), as.numeric))
o$bbox |> str_split(",")
o$bbox |> str_split(",") |> as.vector() |> as.numeric()
o$bbox |> str_split(",") |> sapply(as.numeric)
o$bbox |> str_split(",") |> sapply(as.numeric) |> as.vector()
o$bbox |> str_split(",") |> sapply(as.numeric) |> as.vector() |> st_as_sf()
o$bbox |> str_split(",") |> sapply(as.numeric) |> as.vector() |> st_sf()
o$bbox |> str_split(",") |> sapply(as.numeric) |> as.vector() |> st_polygon()
o$bbox |> str_split(",") |> sapply(as.numeric) |> st_polygon()
?st_polygon
o$bbox |> str_split(",") |> lapply(as.numeric) |>
cat()
o$bbox |> str_split(",") |> lapply(as.numeric)
o$bbox |> str_split(",") |> lapply(as.numeric) |> st_polygon()
o$bbox |> str_split(",") |> lapply(as.numeric) |> is.list()
o$bbox |> str_split(",") |> lapply(as.numeric) |> st_polygon(dim = "XY")
o$bbox |> str_split(",") |> sapply(as.numeric) |> list() |>  st_polygon(dim = "XY")
o$bbox |> str_split(",") |> sapply(as.numeric) |> list()
o$bbox |> str_split(",") |> sapply(as.numeric) |> as.vector() |> list()
o$bbox |> str_split(",") |> sapply(as.numeric) |> as.vector() |> as.list()
?st_transform
st_transform(o$bbox, crs = "EPSG:25831")
o$bbox |> str_split(",") |> sapply(as.numeric) |> as.vector() |> st_transform(crs = "EPSG:25831")
o$bbox |> str_split(",") |> sapply(as.numeric) |> matrix(ncol = 2)
o$bbox |> str_split(",") |> sapply(as.numeric) |> matrix(ncol = 2) |> t()
o$bbox |> str_split(",") |> sapply(as.numeric) |> matrix(ncol = 2) |> t() |> list()
o$bbox |> str_split(",") |> sapply(as.numeric) |> matrix(ncol = 2) |> t() |> as.list()
bbox
list(bbox[1,2], bbox[1,4], bbox[3,2], bbox[3,4])
get_bbox <- function(opq, convert = TRUE){
bbox <- opq$bbox
bbox <- as.vector(sapply(str_split(bbox,","), as.numeric))
if(convert==FALSE)return(bbox)
else{
bbox_sf <- list(bbox[c(1,2)], bbox[c(1,4)], bbox[c(3,2)], bbox[c(3,4)])
}
return(bbox)
}
bbox_sf <- list(bbox[c(1,2)], bbox[c(1,4)], bbox[c(3,2)], bbox[c(3,4)])
st_polygon(bbox_sf)
st_polygon(bbox_sf, dim = "XY")
st_as_sfc(o$bbox)
lapply(bbox_sf, st_point)
bbox_sf |> lapply(st_point)
bbox_sf |> lapply(st_point) |> st_polygon()
matrix(1:20, 4)
matrix(1:20, 4) |> st_multipoint()
matrix(1:20, ,4) |> st_multipoint()
matrix(bbox, ,2)
matrix(bbox, 2,)
matrix(bbox, 2,) |> st_multipoint()
matrix(bbox, 2,) |> t() |>  st_multipoint()
matrix(bbox, 2,) |> t() |>  st_multipoint() |> st_polygon()
matrix(bbox, 2,) |> t() |>  st_multipoint() |> st_cast("polygon")
matrix(bbox, 2,) |> t() |>  st_multipoint() |> st_cast("polygon") |> qtm()
matrix(bbox, 2,) |> t() |>  st_multipoint() |> st_cast("polygon") |> tmap::qtm()
matrix(bbox, 2,) |> t() |>  st_multipoint() |> st_cast("polygon") |> st_as_sf()
matrix(bbox, 2,) |> t() |>  st_polygon()
matrix(bbox, 2,) |> t() |>  lapply(\(x) cbind(x,0))
bbox |>
matrix(,2,) |>
t() |>
as.data.frame()
bbox_sf <- bbox |>
matrix(,2,) |>
t() |>
as.data.frame()
row.names(bbox_sf) <- NULL
colnames(bbox_sf) <- c("Y", "X")
bbox_sf
bbox_sf <- bbox_sf |>
st_as_sf(coords = c("X", "Y"), crs = "EPSG:4326") |>
st_transform(crs = "EPSG:25831")
bbox_sf
bbox_sf |> st_coordinates()
bbox_sf <- st_coordinates(bbox_sf)
opq$bbox
o$bbox
opq("Berga")
getbb("Berga", format_out = "polygon")
getbb("Berga", format_out = "polygon") |> tmap::qtm()
getbb("Berga", format_out = "polygon") |> st_polygon()
getbb("Berga", format_out = "polygon") |> st_polygon() |> tmap::qtm()
getbb("Berga", format_out = "polygon") |> st_polygon() |> st_sf() |> tmap::qtm()
getbb("Berga", format_out = "polygon") |> st_polygon() |> st_sf()
getbb("Berga", format_out = "polygon") |> st_polygon() |> st_as_sf()
getbb("Berga", format_out = "polygon") |> st_polygon() |> st_as_sfc()
bb <- getbb("Berga", format_out = "polygon") |> st_polygon()
bb
st_as_sf(bb)
?getbb
getbb("Berga")
getbb("Berga", format_out = "sf_polygon")
getbb("Berga", format_out = "sf_polygon") |> tmap:qtm()
getbb("Berga", format_out = "sf_polygon") |> tmap::qtm()
getbb("Berga", format_out = "sf_polygon") |> st_bbox()
library(tidyverse)
library(osmdata)
library(sf)
sf_bb <- getbb("Berga", format_out = "sf_polygon")
sf_bb[1]
sf_bb[1,]
sf_bb[1,] |> st_bbox()
bbox
bbox[1]
get_filter_bbox <- function(place, transform = FALSE, end_crs = "EPSG:25831"){
if(transform == FALSE){
opq <- opq(place)
bbox <- opq$bbox
bbox <- as.vector(sapply(str_split(bbox,","), as.numeric))
return(bbox)
}
else{
bbox <- getbb(place, format_out = "sf_polygon")
bbox <- st_tranform(st_bbox[1,], crs = end_crs)
bbox <- st_bbox(bbox)
bbox <- unname(bbox)
bbox <- c(bbox[2], bbox[1], bbox[4], bbox[3])
return(bbox)
}
}
get_filter_bbox("Berga")
get_filter_bbox("Berga", transform = TRUE)
get_filter_bbox <- function(place, transform = FALSE, end_crs = "EPSG:25831"){
if(transform == FALSE){
opq <- opq(place)
bbox <- opq$bbox
bbox <- as.vector(sapply(str_split(bbox,","), as.numeric))
return(bbox)
}
else{
bbox <- getbb(place, format_out = "sf_polygon")
bbox <- st_transform(st_bbox[1,], crs = end_crs)
bbox <- st_bbox(bbox)
bbox <- unname(bbox)
bbox <- c(bbox[2], bbox[1], bbox[4], bbox[3])
return(bbox)
}
}
get_filter_bbox("Berga", transform = TRUE)
get_filter_bbox <- function(place, transform = FALSE, end_crs = "EPSG:25831"){
if(transform == FALSE){
opq <- opq(place)
bbox <- opq$bbox
bbox <- as.vector(sapply(str_split(bbox,","), as.numeric))
return(bbox)
}
else{
bbox <- getbb(place, format_out = "sf_polygon")
bbox <- st_transform(bbox[1,], crs = end_crs)
bbox <- st_bbox(bbox)
bbox <- unname(bbox)
bbox <- c(bbox[2], bbox[1], bbox[4], bbox[3])
return(bbox)
}
}
get_filter_bbox("Berga", transform = TRUE)
library(tmap)
library(tidyverse)
library(tidygeocoder)
library(sf)
library(httr)
library(jsonlite)
library(osmdata)
source("code/get_filter_bbox.R")
get_filter_bbox("Santpedor")
bbox <- get_filter_bbox("Santpedor", transform = TRUE)
box
bbox
url <- paste0("https://do.diba.cat/api/dataset/establiments/","camp-utm_x-greaterequal/",bbox[2],
"/camp-utm_x-lowerequal/", bbox[4],
"/camp-utm_y-greaterequal", bbox[1],
"/camp-utm_y-lowerequal/", bbox[3])
url
url <- paste0("https://do.diba.cat/api/dataset/establiments/","camp-utm_x-greaterequal/",bbox[2],
"/camp-utm_x-lowerequal/", bbox[4],
"/camp-utm_y-greaterequal/", bbox[1],
"/camp-utm_y-lowerequal/", bbox[3])
url
establiments <- GET(url) |>
content(as = "text") |>
fromJSON()
View(establiments)
establiments$elements
establiments <- establiments$elements
establiments$adreca
establiments <- establiments |>
unnest(adreca)
?get_filter_bbox
scales::show_col(ksnet::paletas_ksnet$verde)
scales::show_col(ksnet::paletas_ksnet$bright)
